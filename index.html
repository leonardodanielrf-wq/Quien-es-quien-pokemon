<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>¬øQui√©n es qui√©n? Pok√©mon Online</title>
<style>
body{font-family:Arial;margin:0;padding:15px;text-align:center;background:#f5f5f5}
.hidden{display:none}
.grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:15px}
.card{background:white;border:2px solid #ccc;border-radius:10px;padding:5px;font-size:12px;cursor:pointer}
.card img{width:70px;height:70px}
.discarded{opacity:0.3;filter:grayscale(100%)}
button,select,input{padding:8px;font-size:16px;margin:5px}
</style>
</head>
<body>

<h1>¬øQui√©n es qui√©n? Pok√©mon Online</h1>

<div id="inicio">
  <input id="roomInput" placeholder="C√≥digo de sala">
  <button onclick="crearSala()">Crear sala</button>
  <button onclick="unirseSala()">Unirse</button>
  <p id="roomInfo"></p>
</div>

<div id="seleccion" class="hidden">
  <h2>Elige tu Pok√©mon</h2>
  <select id="pokemonSelect"></select><br>
  <button onclick="confirmarPokemon()">Confirmar</button>
</div>

<div id="tablero" class="hidden">
  <h2 id="turnoTexto"></h2>
  <div class="grid" id="grid"></div>
  <button onclick="adivinar()">Adivinar</button>
</div>

<script type="module">
// üî• Firebase SDK (VERSI√ìN MODERNA)
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, onValue, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// ‚úÖ TU CONFIGURACI√ìN (YA CORRECTA)
const firebaseConfig = {
  apiKey: "AIzaSyDU1gPweD4H5kb6DuoUyFUD2wYfxCCJhS0",
  authDomain: "quien-es-quien-estilo-pokemon.firebaseapp.com",
  databaseURL: "https://quien-es-quien-estilo-pokemon-default-rtdb.firebaseio.com",
  projectId: "quien-es-quien-estilo-pokemon",
  storageBucket: "quien-es-quien-estilo-pokemon.firebasestorage.app",
  messagingSenderId: "271657724830",
  appId: "1:271657724830:web:ae35ca7e105eb000cd448f",
  measurementId: "G-PWSB0GMVQ1"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// --- POK√âMON ---
const pokemonList = [];
for (let i = 1; i <= 151; i++) {
  pokemonList.push({ id: i, name: "Pokemon " + i });
}

const select = document.getElementById("pokemonSelect");
pokemonList.forEach(p => {
  const opt = document.createElement("option");
  opt.value = p.id;
  opt.textContent = p.name;
  select.appendChild(opt);
});

let room = "";
let playerId = "";
let opponent = "";
let myPokemon = null;
let table = [];

// --- SALAS ---
window.crearSala = function () {
  room = Math.random().toString(36).substring(2, 7);
  playerId = "player1";
  opponent = "player2";
  document.getElementById("roomInfo").innerText = "C√≥digo de sala: " + room;
  document.getElementById("seleccion").classList.remove("hidden");
}

window.unirseSala = function () {
  room = document.getElementById("roomInput").value;
  if (!room) return alert("Introduce un c√≥digo");
  playerId = "player2";
  opponent = "player1";
  document.getElementById("seleccion").classList.remove("hidden");
}

// --- JUEGO ---
window.confirmarPokemon = function () {
  myPokemon = select.value;
  set(ref(db, `rooms/${room}/${playerId}`), { pokemon: myPokemon });
  esperarRival();
}

function esperarRival() {
  onValue(ref(db, `rooms/${room}/${opponent}`), snap => {
    if (snap.exists()) iniciarJuego();
  });
}

function iniciarJuego() {
  document.getElementById("seleccion").classList.add("hidden");
  document.getElementById("tablero").classList.remove("hidden");
  document.getElementById("turnoTexto").innerText = "Descarta y adivina el Pok√©mon del rival";
  generarTabla();
}

function generarTabla() {
  let pool = [...pokemonList];
  pool.sort(() => Math.random() - 0.5);
  table = pool.slice(0, 40);
  render();
}

function render() {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";
  table.forEach(p => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${p.id}.png"><div>${p.name}</div>`;
    card.onclick = () => card.classList.toggle("discarded");
    grid.appendChild(card);
  });
}

window.adivinar = async function () {
  const guess = prompt("¬øQu√© n√∫mero de Pok√©mon crees que es?");
  if (!guess) return;
  const snap = await get(child(ref(db), `rooms/${room}/${opponent}`));
  const rivalPokemon = snap.val().pokemon;
  if (guess === rivalPokemon) {
    alert("üéâ ¬°Ganaste!");
    location.reload();
  } else {
    alert("‚ùå Fallaste");
  }
}
</script>
</body>
</html>

